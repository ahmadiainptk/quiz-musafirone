<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAS Matematika Kelas 9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- KaTeX untuk Rumus Matematika -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        body { font-family: 'Nunito', sans-serif; background-color: #f0f9ff; -webkit-tap-highlight-color: transparent; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #93c5fd; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #60a5fa; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .option-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .option-btn:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .option-btn.selected {
            background-color: #eff6ff;
            border-color: #2563eb;
            color: #1e40af;
        }
        
        /* Grid Nav */
        .grid-btn {
            width: 35px; height: 35px; font-size: 0.8rem;
            display: flex; align-items: center; justify-content: center;
            border-radius: 6px; cursor: pointer; transition: all 0.2s;
        }
        .grid-btn.active { background-color: #2563eb; color: white; border: none; font-weight: bold; }
        .grid-btn.answered { background-color: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }
        .grid-btn.unanswered { background-color: white; border: 1px solid #e2e8f0; color: #64748b; }

        .katex { font-size: 1.1em; }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- HEADER -->
    <header class="bg-white shadow-sm border-b border-slate-200 z-20 relative">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 text-white p-2 rounded-lg shadow-lg shadow-indigo-200">
                    <i class="fas fa-calculator"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg leading-tight md:text-xl text-slate-800">PAS Matematika Kelas 9</h1>
                    <p class="text-xs text-slate-500 font-semibold">40 Soal • Pangkat, Akar, Bangun Ruang, Kuadrat</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden md:flex flex-col items-end">
                    <span class="text-xs text-slate-500 font-bold uppercase tracking-wider">Sisa Waktu</span>
                    <span id="timer" class="font-mono text-xl font-bold text-indigo-600">120:00</span>
                </div>
                <button onclick="toggleSidebar()" class="md:hidden text-slate-600 hover:text-indigo-600 transition">
                    <i class="fas fa-th-large text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative">
        
        <!-- SIDEBAR -->
        <aside id="sidebar" class="absolute md:relative inset-y-0 left-0 transform -translate-x-full md:translate-x-0 w-72 bg-white border-r border-slate-200 shadow-xl md:shadow-none transition-transform duration-300 z-30 flex flex-col">
            <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 class="font-bold text-slate-700">Nomor Soal</h3>
                <span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-bold" id="progress-text">0/40</span>
            </div>
            <div class="flex-1 overflow-y-auto p-4">
                <div class="grid grid-cols-5 gap-2" id="question-grid">
                    <!-- Grid generated by JS -->
                </div>
            </div>
            <div class="p-4 border-t border-slate-100 bg-slate-50">
                <button onclick="finishQuiz()" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-xl shadow-lg transition active:scale-95 flex items-center justify-center gap-2">
                    <i class="fas fa-check-circle"></i> Selesai Ujian
                </button>
            </div>
        </aside>

        <!-- OVERLAY -->
        <div id="sidebar-overlay" onclick="toggleSidebar()" class="absolute inset-0 bg-black/50 z-20 hidden md:hidden glass-panel"></div>

        <!-- MAIN CONTENT -->
        <main class="flex-1 overflow-y-auto bg-slate-50 relative w-full">
            <div class="max-w-3xl mx-auto p-4 md:p-8 pb-24">
                
                <!-- START SCREEN -->
                <div id="start-screen" class="flex flex-col items-center justify-center min-h-[60vh] text-center">
                    <div class="w-24 h-24 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mb-6 text-4xl shadow-indigo-200 shadow-xl">
                        <i class="fas fa-square-root-alt"></i>
                    </div>
                    <h2 class="text-3xl font-extrabold text-slate-800 mb-3">Siap Ujian Matematika?</h2>
                    <p class="text-slate-500 mb-8 max-w-md">Materi: Bilangan Berpangkat, Bentuk Akar, Bangun Ruang Sisi Datar & Lengkung, Persamaan Kuadrat.</p>
                    <button onclick="startQuiz()" class="bg-indigo-600 text-white px-10 py-4 rounded-full font-bold text-lg shadow-xl shadow-indigo-200 hover:bg-indigo-700 transition transform hover:-translate-y-1">
                        Mulai Mengerjakan
                    </button>
                </div>

                <!-- QUESTION CARD -->
                <div id="quiz-container" class="hidden">
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-6 relative">
                        <div class="h-1 bg-slate-100 w-full">
                            <div id="progress-bar" class="h-full bg-indigo-500 transition-all duration-300" style="width: 0%"></div>
                        </div>
                        
                        <div class="p-6 md:p-8">
                            <div class="flex justify-between items-start mb-6">
                                <span class="text-sm font-bold text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full border border-indigo-100">Soal No. <span id="q-number">1</span></span>
                                <button class="text-slate-400 hover:text-red-500" onclick="resetCurrentAnswer()" title="Hapus Jawaban"><i class="fas fa-eraser"></i></button>
                            </div>
                            
                            <!-- Kontainer soal dengan dukungan MathJax/Katex -->
                            <div id="q-text" class="text-lg md:text-xl font-bold text-slate-800 mb-8 leading-relaxed"></div>

                            <div id="options-container" class="space-y-3"></div>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="flex justify-between gap-4">
                        <button onclick="prevQuestion()" id="btn-prev" class="flex-1 bg-white border border-slate-300 text-slate-700 font-bold py-3 rounded-xl hover:bg-slate-50 transition disabled:opacity-50">
                            <i class="fas fa-arrow-left mr-2"></i> Sebelumnya
                        </button>
                        <button onclick="nextQuestion()" id="btn-next" class="flex-1 bg-indigo-600 text-white font-bold py-3 rounded-xl hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition">
                            Selanjutnya <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- RESULT SCREEN -->
                <div id="result-screen" class="hidden text-center py-8">
                    <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-100 max-w-lg mx-auto">
                        <h2 class="text-2xl font-bold text-slate-800 mb-1">Hasil Ujian</h2>
                        <div class="text-6xl font-black text-indigo-600 mb-6 mt-4" id="final-score">0</div>
                        <div class="grid grid-cols-3 gap-2 mb-8 text-sm">
                            <div class="bg-green-50 p-3 rounded-xl border border-green-100 text-green-700 font-bold">
                                <span id="total-correct" class="text-lg block">0</span> Benar
                            </div>
                            <div class="bg-red-50 p-3 rounded-xl border border-red-100 text-red-700 font-bold">
                                <span id="total-wrong" class="text-lg block">0</span> Salah
                            </div>
                            <div class="bg-slate-50 p-3 rounded-xl border border-slate-200 text-slate-700 font-bold">
                                <span id="total-skipped" class="text-lg block">0</span> Kosong
                            </div>
                        </div>
                        <button onclick="location.reload()" class="w-full bg-indigo-600 text-white font-bold py-3.5 rounded-xl hover:bg-indigo-700 transition">Ulangi Ujian</button>
                    </div>
                </div>

            </div>
        </main>
    </div>

<script>
// --- DATA SOAL SESUAI KISI-KISI MTK KELAS 9 ---
const questionsData = [
    // 1. Bentuk bilangan berpangkat
    { text: "Bentuk perkalian berulang dari \\( 5^4 \\) adalah...", options: ["\\( 5+5+5+5 \\)", "\\( 4 \\times 5 \\)", "\\( 5 \\times 5 \\times 5 \\times 5 \\)", "\\( 4 \\times 4 \\times 4 \\times 4 \\times 4 \\)"], answer: 2 },
    // 2. Hasil bilangan berpangkat
    { text: "Hasil dari \\( (-3)^3 \\) adalah...", options: ["-9", "27", "-27", "9"], answer: 2 },
    // 3. Pernyataan yang benar
    { text: "Pernyataan di bawah ini yang benar adalah...", options: ["\\( 2^3 = 2 \\times 3 \\)", "\\( 3^2 = 2^3 \\)", "\\( a^m \\times a^n = a^{m+n} \\)", "\\( (a^m)^n = a^{m+n} \\)"], answer: 2 },
    // 4. Operasi campuran
    { text: "Hasil dari \\( 2^3 + 3^2 - 4^0 \\) adalah...", options: ["16", "17", "13", "14"], answer: 0 },
    // 5. Notasi Ilmiah
    { text: "Bentuk baku (notasi ilmiah) dari 0,0000345 adalah...", options: ["\\( 3,45 \\times 10^{-5} \\)", "\\( 3,45 \\times 10^{-4} \\)", "\\( 34,5 \\times 10^{-6} \\)", "\\( 3,45 \\times 10^{5} \\)"], answer: 0 },
    // 6. Penjumlahan/Pengurangan Akar
    { text: "Hasil dari \\( 3\\sqrt{5} + 4\\sqrt{5} - 2\\sqrt{5} \\) adalah...", options: ["\\( 9\\sqrt{5} \\)", "\\( 5\\sqrt{5} \\)", "\\( 5\\sqrt{15} \\)", "\\( 7\\sqrt{5} \\)"], answer: 1 },
    // 7. Perkalian Akar
    { text: "Hasil dari \\( \\sqrt{8} \\times \\sqrt{3} \\) adalah...", options: ["\\( 2\\sqrt{6} \\)", "\\( 2\\sqrt{3} \\)", "\\( \\sqrt{11} \\)", "\\( 3\\sqrt{2} \\)"], answer: 0 },
    // 8. Merasionalkan akar sederhana
    { text: "Bentuk rasional dari \\( \\frac{6}{\\sqrt{3}} \\) adalah...", options: ["\\( 2\\sqrt{3} \\)", "\\( 3\\sqrt{3} \\)", "\\( \\sqrt{3} \\)", "\\( 6\\sqrt{3} \\)"], answer: 0 },
    // 9. Merasionalkan c/(a+b)
    { text: "Bentuk rasional dari \\( \\frac{4}{3+\\sqrt{5}} \\) adalah...", options: ["\\( 3-\\sqrt{5} \\)", "\\( 3+\\sqrt{5} \\)", "\\( 4(3-\\sqrt{5}) \\)", "\\( 2(3-\\sqrt{5}) \\)"], answer: 0 },
    // 10. Soal Cerita Akar
    { text: "Sebuah persegi memiliki luas \\( 20 \\text{ cm}^2 \\). Panjang sisi persegi tersebut adalah...", options: ["\\( 2\\sqrt{5} \\)", "\\( 4\\sqrt{5} \\)", "\\( 5 \\)", "\\( 10 \\)"], answer: 0 },
    // 11. Pembagian Pangkat
    { text: "Bentuk sederhana dari \\( \\frac{a^6 b^4}{a^2 b} \\) adalah...", options: ["\\( a^3 b^4 \\)", "\\( a^4 b^3 \\)", "\\( a^8 b^5 \\)", "\\( a^4 b^4 \\)"], answer: 1 },
    // 12. Sifat Kubus
    { text: "Berikut ini yang BUKAN merupakan sifat kubus adalah...", options: ["Memiliki 6 sisi berbentuk persegi", "Memiliki 12 rusuk sama panjang", "Memiliki 8 titik sudut", "Memiliki sisi yang berbentuk persegi panjang"], answer: 3 },
    // 13. Tinggi Balok (L diketahui)
    { text: "Luas permukaan balok adalah 376 cm². Jika panjang 10 cm dan lebar 6 cm, maka tinggi balok adalah...", options: ["6 cm", "7 cm", "8 cm", "9 cm"], answer: 2 },
    // 14. Kerangka Balok
    { text: "Kawat sepanjang 5 meter akan dibuat kerangka balok uk 10x8x7 cm. Banyak kerangka yang bisa dibuat...", options: ["4 buah", "5 buah", "6 buah", "2 buah"], answer: 1 },
    // 15. LP Kubus
    { text: "Luas permukaan kubus yang panjang rusuknya 8 cm adalah...", options: ["384 cm²", "512 cm²", "216 cm²", "64 cm²"], answer: 0 },
    // 16. Volume Prisma
    { text: "Alas sebuah prisma berbentuk segitiga siku-siku dengan panjang sisi siku-sikunya 3 cm dan 4 cm. Jika tinggi prisma 10 cm, volumenya adalah...", options: ["60 cm³", "120 cm³", "70 cm³", "30 cm³"], answer: 0 },
    // 17. Tinggi Prisma (V diketahui)
    { text: "Volume prisma 240 cm³ dan luas alasnya 20 cm². Tinggi prisma tersebut adalah...", options: ["10 cm", "12 cm", "24 cm", "15 cm"], answer: 1 },
    // 18. LP Limas
    { text: "Sebuah limas persegi memiliki sisi alas 10 cm dan tinggi sisi tegak (segitiga) 12 cm. Luas permukaannya adalah...", options: ["340 cm²", "240 cm²", "100 cm²", "480 cm²"], answer: 0 },
    // 19. Luas Alas Limas (V diketahui)
    { text: "Volume limas 100 cm³ dan tingginya 12 cm. Luas alas limas tersebut adalah...", options: ["25 cm²", "20 cm²", "30 cm²", "15 cm²"], answer: 0 },
    // 20. LP Prisma
    { text: "Prisma segitiga memiliki keliling alas 24 cm dan tinggi prisma 10 cm. Luas selimut prisma (luas sisi tegak) adalah...", options: ["240 cm²", "120 cm²", "360 cm²", "480 cm²"], answer: 0 },
    // 21. LP Tabung
    { text: "Luas permukaan tabung dengan jari-jari 7 cm dan tinggi 10 cm adalah... (\\(\\pi = \\frac{22}{7}\\))", options: ["748 cm²", "648 cm²", "528 cm²", "440 cm²"], answer: 0 },
    // 22. Sifat Belah Ketupat (Sesuai Indikator, meski Materi tertulis sisi lengkung)
    { text: "Sifat belah ketupat yang benar adalah...", options: ["Keempat sisinya sama panjang", "Keempat sudutnya siku-siku", "Diagonalnya sama panjang", "Tidak memiliki simetri lipat"], answer: 0 },
    // 23. Garis Pelukis Kerucut (V diketahui? Biasanya r dan t) -> Asumsi r dan t diketahui untuk cari s
    { text: "Sebuah kerucut memiliki jari-jari 3 cm dan tinggi 4 cm. Panjang garis pelukisnya (s) adalah...", options: ["5 cm", "6 cm", "7 cm", "8 cm"], answer: 0 },
    // 24. Volume Bola
    { text: "Volume bola dengan jari-jari 10 cm adalah... (\\(\\pi = 3,14\\))", options: ["4186,67 cm³", "3140 cm³", "1256 cm³", "2093 cm³"], answer: 0 },
    // 25. LP Kerucut
    { text: "Luas permukaan kerucut dengan r = 7 cm dan s = 10 cm adalah...", options: ["374 cm²", "154 cm²", "220 cm²", "528 cm²"], answer: 0 },
    // 26. Sifat Bangun Sisi Lengkung
    { text: "Bangun ruang yang tidak memiliki titik sudut adalah...", options: ["Kerucut", "Tabung", "Bola", "Limas"], answer: 2 },
    // 27. Tinggi Tabung (V diketahui)
    { text: "Volume tabung 1.540 cm³ dan jari-jari 7 cm. Tinggi tabung adalah... (\\(\\pi = \\frac{22}{7}\\))", options: ["10 cm", "15 cm", "20 cm", "5 cm"], answer: 0 },
    // 28. Bagian Kerucut
    { text: "Garis yang menghubungkan titik puncak kerucut dengan keliling alas disebut...", options: ["Garis pelukis", "Tinggi kerucut", "Diameter", "Jari-jari"], answer: 0 },
    // 29. Tinggi Kerucut (Luas Selimut diketahui)
    { text: "Luas selimut kerucut 550 cm² dan jari-jari 7 cm. Jika garis pelukisnya 25 cm, maka tinggi kerucut adalah... (gunakan Pythagoras)", options: ["24 cm", "20 cm", "21 cm", "18 cm"], answer: 0 },
    // 30. Gambar Bangun
    { text: "Perhatikan ciri berikut: Memiliki alas lingkaran dan 1 titik puncak. Bangun tersebut adalah...", options: ["Tabung", "Kerucut", "Bola", "Prisma"], answer: 1 },
    // 31. Bentuk Persamaan Kuadrat
    { text: "Manakah yang merupakan persamaan kuadrat?", options: ["\\( x^2 + 2x - 5 = 0 \\)", "\\( 2x + 5 = 0 \\)", "\\( x^3 + x^2 = 0 \\)", "\\( x + y = 5 \\)"], answer: 0 },
    // 32. Operasi Akar (x1 + x2)
    { text: "Jika \\( x_1 \\) dan \\( x_2 \\) adalah akar dari \\( x^2 - 3x + 2 = 0 \\), nilai \\( x_1 + x_2 \\) adalah...", options: ["3", "-3", "2", "-2"], answer: 0 },
    // 33. Menentukan Persamaan
    { text: "Persamaan kuadrat yang akar-akarnya 2 dan 3 adalah...", options: ["\\( x^2 - 5x + 6 = 0 \\)", "\\( x^2 + 5x + 6 = 0 \\)", "\\( x^2 - x - 6 = 0 \\)", "\\( x^2 + x - 6 = 0 \\)"], answer: 0 },
    // 34. Rumus ABC
    { text: "Akar-akar dari \\( x^2 - 4x - 5 = 0 \\) adalah...", options: ["5 dan -1", "-5 dan 1", "2 dan 3", "-2 dan -3"], answer: 0 },
    // 35. Diskriminan
    { text: "Jika nilai diskriminan \\( D > 0 \\), maka jenis akar persamaan kuadrat adalah...", options: ["Real dan berbeda", "Real dan kembar", "Tidak real (imajiner)", "Rasional"], answer: 0 },
    // 36. Akar Persamaan (Faktorisasi)
    { text: "Himpunan penyelesaian dari \\( x^2 - 9 = 0 \\) adalah...", options: ["{3, -3}", "{3, 0}", "{9, -9}", "{0, 9}"], answer: 0 },
    // 37. Sumbu Simetri
    { text: "Sumbu simetri dari fungsi \\( y = x^2 - 6x + 8 \\) adalah...", options: ["x = 3", "x = -3", "x = 6", "x = 2"], answer: 0 },
    // 38. Nilai Optimum
    { text: "Nilai minimum dari fungsi \\( y = x^2 + 2x - 3 \\) adalah...", options: ["-4", "-3", "0", "1"], answer: 0 },
    // 39. PK Baru
    { text: "Jika akar-akar persamaan \\( x^2 - 2x + 1 = 0 \\) adalah \\( p \\) dan \\( q \\), persamaan kuadrat baru yang akarnya \\( p+2 \\) dan \\( q+2 \\) adalah...", options: ["\\( x^2 - 6x + 9 = 0 \\)", "\\( x^2 + 6x + 9 = 0 \\)", "\\( x^2 - 4x + 4 = 0 \\)", "\\( x^2 - 2x + 5 = 0 \\)"], answer: 0 },
    // 40. Titik Potong Sumbu X
    { text: "Grafik fungsi \\( y = x^2 - 3x + 2 \\) memotong sumbu X di titik...", options: ["(1,0) dan (2,0)", "(-1,0) dan (-2,0)", "(0,1) dan (0,2)", "(1,1) dan (2,2)"], answer: 0 }
];

// STATE & DOM
let currentQuestionIndex = 0;
let userAnswers = new Array(questionsData.length).fill(null);
let timeLeft = 120 * 60; // 120 menit
let timerInterval;

const questionText = document.getElementById('q-text');
const optionsContainer = document.getElementById('options-container');
const questionNumber = document.getElementById('q-number');
const progressBar = document.getElementById('progress-bar');
const prevBtn = document.getElementById('btn-prev');
const nextBtn = document.getElementById('btn-next');
const gridContainer = document.getElementById('question-grid');
const timerDisplay = document.getElementById('timer');

function initGrid() {
    gridContainer.innerHTML = '';
    questionsData.forEach((_, i) => {
        const btn = document.createElement('div');
        btn.className = 'grid-btn unanswered';
        btn.innerText = i + 1;
        btn.onclick = () => jumpToQuestion(i);
        btn.id = `grid-btn-${i}`;
        gridContainer.appendChild(btn);
    });
}

function startQuiz() {
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('quiz-container').classList.remove('hidden');
    initGrid();
    loadQuestion(0);
    startTimer();
}

function loadQuestion(index) {
    currentQuestionIndex = index;
    const q = questionsData[index];
    
    questionNumber.innerText = index + 1;
    questionText.innerHTML = q.text;
    renderMathInElement(questionText); // Render Latex

    const progress = ((index + 1) / questionsData.length) * 100;
    progressBar.style.width = `${progress}%`;

    optionsContainer.innerHTML = '';
    q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = `w-full text-left p-4 rounded-xl border border-slate-200 option-btn hover:border-indigo-300 relative ${userAnswers[index] === i ? 'selected' : 'bg-white'}`;
        const label = String.fromCharCode(65 + i);
        btn.innerHTML = `<span class="font-bold mr-3 ${userAnswers[index] === i ? 'text-indigo-600' : 'text-slate-400'}">${label}.</span> ${opt}`;
        btn.onclick = () => selectAnswer(index, i);
        optionsContainer.appendChild(btn);
    });
    
    // Render math di pilihan jawaban
    renderMathInElement(optionsContainer);

    prevBtn.disabled = index === 0;
    if (index === questionsData.length - 1) {
        nextBtn.innerHTML = 'Selesai <i class="fas fa-check ml-2"></i>';
        nextBtn.classList.replace('bg-indigo-600', 'bg-green-600');
        nextBtn.classList.replace('hover:bg-indigo-700', 'hover:bg-green-700');
        nextBtn.onclick = finishQuiz;
    } else {
        nextBtn.innerHTML = 'Selanjutnya <i class="fas fa-arrow-right ml-2"></i>';
        nextBtn.classList.replace('bg-green-600', 'bg-indigo-600');
        nextBtn.classList.replace('hover:bg-green-700', 'hover:bg-indigo-700');
        nextBtn.onclick = nextQuestion;
    }

    document.querySelectorAll('.grid-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(`grid-btn-${index}`).classList.add('active');
}

function selectAnswer(qIndex, optionIndex) {
    userAnswers[qIndex] = optionIndex;
    document.getElementById(`grid-btn-${qIndex}`).classList.replace('unanswered', 'answered');
    loadQuestion(qIndex);
    updateProgressText();
}

function resetCurrentAnswer() {
    userAnswers[currentQuestionIndex] = null;
    document.getElementById(`grid-btn-${currentQuestionIndex}`).classList.replace('answered', 'unanswered');
    loadQuestion(currentQuestionIndex);
    updateProgressText();
}

function nextQuestion() {
    if (currentQuestionIndex < questionsData.length - 1) loadQuestion(currentQuestionIndex + 1);
}

function prevQuestion() {
    if (currentQuestionIndex > 0) loadQuestion(currentQuestionIndex - 1);
}

function jumpToQuestion(index) {
    loadQuestion(index);
    if(window.innerWidth < 768) toggleSidebar();
}

function updateProgressText() {
    const count = userAnswers.filter(a => a !== null).length;
    document.getElementById('progress-text').innerText = `${count}/${questionsData.length}`;
}

function startTimer() {
    timerInterval = setInterval(() => {
        timeLeft--;
        const m = Math.floor(timeLeft / 60);
        const s = timeLeft % 60;
        timerDisplay.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        if (timeLeft <= 0) finishQuiz();
    }, 1000);
}

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    sidebar.classList.toggle('-translate-x-full');
    overlay.classList.toggle('hidden');
}

function finishQuiz() {
    if (!confirm('Yakin ingin menyelesaikan ujian?')) return;
    clearInterval(timerInterval);
    
    let score = 0, correct = 0, wrong = 0, skipped = 0;
    userAnswers.forEach((ans, i) => {
        if (ans === null) skipped++;
        else if (ans === questionsData[i].answer) { score++; correct++; }
        else wrong++;
    });

    const finalScore = Math.round((score / questionsData.length) * 100);
    document.getElementById('final-score').innerText = finalScore;
    document.getElementById('total-correct').innerText = correct;
    document.getElementById('total-wrong').innerText = wrong;
    document.getElementById('total-skipped').innerText = skipped;

    document.getElementById('quiz-container').classList.add('hidden');
    document.getElementById('result-screen').classList.remove('hidden');
}
</script>
</body>
</html>

